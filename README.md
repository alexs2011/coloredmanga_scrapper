# ColoredMangaScrapper

## 1. Описание

ColoredMangaScrapper - это консольное приложение, позволяющее загружать мангу с
сайта [coloredmanga.com](https://coloredmanga.com/), на котором расположены манги с улучшенным (увеличенным) при помощи
нейросетей разрешением страниц. Приложение создано для помощи пользователю в скачивании контента в ситуациях, когда к
нему необходим офлайн доступ.

---

## 2. Принцип работы программы

Манга (изданная на бумаге) может быть представлена следующей иерархией сущностей: манга - том - глава - страница. Манга,
расположенная на сайте, сохраняет, как правило, этот принцип, при этом информация о томах и главах располагается на
главной странице манги, а информация о страницах, представляющих собой изображения, — на странице той главы, к которой
они относятся. Однако в некоторых случаях манга на сайте не имеет томов, и представляет собой список глав.

### 2.1. Версии программы

В репозитории расположены две версии приложения:

1) [coloredmanga_scrapper_sync](https://github.com/alexs2011/coloredmanga_scrapper/tree/master/coloredmanga_scrapper_sync)
   загружает данные последовательно
2) [coloredmanga_scrapper_async](https://github.com/alexs2011/coloredmanga_scrapper/tree/master/coloredmanga_scrapper_async)
   производит асинхронную загрузку файлов

Асинхронная версия позволяет значительно уменьшить время, необходимое программе для скачивания манги, но в остальном с
точки зрения пользователя обе версии идентичны.

### 2.2. Принцип работы

Программа получает html представление главной страницы манги при помощи модуля `requests` и, используя `lxml`, извлекает
необходимую информацию, а именно название манги, названия томов (при наличии) и названия глав и ссылки на них. После,
при помощи вышеназванных модулей, получается html представление для каждой главы и из них извлекаются страницы (
изображения).

При этом:

- в последовательной версии обработка глав происходит по одной за раз (сначала обрабатывается глава 1, потом глава 2 и
  т.д.);
- в асинхронной версии одновременно обрабатываются сразу множество глав.

Если у манги на сайте нет томов, то создаётся том с именем "No Volumes", куда складываются все главы.

Полученная структура манги конвертируется в формат JSON и сохраняется в файл, из которого впоследствии может быть
прочитана.

На следующем этапе происходит загрузка страниц манги на основании структуры в соответствии с заданными параметрами
(см. [Возможности](#3-Возможности)). При этом:

- в последовательной версии поочерёдно проходятся все тома и главы и при этом, если они удовлетворяют заданным
  параметрам, происходит загрузка их страниц;
- в асинхронной версии вначале поочерёдно проходятся все тома и главы и создаётся список всех страниц, которые
  необходимо загрузить, а после в асинхронном режиме происходит их загрузка.

---

## 3. Возможности

### 3.1. Задание диапазона скачивания

Для удобства пользователя в приложении реализована возможность задать диапазон, в котором будет произведена загрузка.
Если у манги на сайте есть тома, то это ограничение задаётся на них. Если томов нет, то ограничение действует для глав.

Значение диапазона задаётся опциональными параметрами `start_with` и `end_with`. Если значение равно 0, то ограничений
на эту границу нет. Если параметр `end_with` задан, то производится скачивание до него не включительно, т.е.
при `start_with=5`
и `end_with=9` будут скачаны тома (либо главы) 5, 6, 7, 8.

Пример использования:

`utils.download_manga(manga_contents, dir_root, start_with=5, end_with=9)`

### 3.2. Создание упрощённой структуры файлов

В приложении реализована возможность создавать при сохранении упрощённую иерархию файлов (без папок для глав, т.е. все
страницы хранятся просто в папке тома). За данное изменение отвечает опциональный параметр `is_flatten`.

    Иерархия при is_flatten=False                   Иерархия при is_flatten=True
    Manga_name.                                     Manga_name.
    +---Volume...                                   \---Volume...
    |   \---Chapter...                                      0001.jpg
    |           001.jpg                                     0002.jpg
    |           002.jpg                                     0003.jpg
    |           003.jpg

Пример использования:

`utils.download_manga(manga_contents, dir_root, is_flatten=True)`

---

## 4. Пример запуска

- Задаём расположение файла, куда будет произведено сохранение структуры манги (если файла нет, то он будет создан).

`file_contents = "..\\coloredmanga_scrapper_async\\data\\contents.json"`

- Задаём корневую директорию, в которой будет создана папка с названием манги и загружены её тома, главы и страницы.

`dir_root = "D:\\"`

- Задаём ссылку на главную страницу манги.

`url = "https://coloredmanga.com/manga/one-piece/"`

- Производим загрузку структуры манги с сайта;

`manga_contents = utils.build_contents(url)`

либо из предварительно сохранённого файла со структурой.

`manga_contents = utils.build_contents(file_contents, from_file=True)`

- Производим сохранение загруженной структуры в файле формата JSON.

`utils.save_contents(manga_contents, filename=file_contents)`

- Производим скачивание манги.

Без опциональных параметров:

`utils.download_manga(manga_contents, dir_root)`

С опциональными параметрами:

`utils.download_manga(manga_contents, dir_root, start_with=3, end_with=25, is_flatten=True)`